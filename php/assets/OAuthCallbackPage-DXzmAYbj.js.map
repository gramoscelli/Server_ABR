{"version":3,"file":"OAuthCallbackPage-DXzmAYbj.js","sources":["../../src/pages/OAuthCallbackPage.tsx"],"sourcesContent":["import { useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { authService } from '@/lib/auth';\n\nexport default function OAuthCallbackPage() {\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const handleOAuthCallback = async () => {\n      try {\n        // Get tokens from URL parameters\n        const accessToken = searchParams.get('accessToken');\n        const refreshToken = searchParams.get('refreshToken');\n        const error = searchParams.get('error');\n\n        // Handle error\n        if (error) {\n          console.error('OAuth error:', error);\n          navigate('/login?error=' + encodeURIComponent(error), { replace: true });\n          return;\n        }\n\n        // Validate tokens\n        if (!accessToken || !refreshToken) {\n          console.error('Missing tokens in OAuth callback');\n          navigate('/login?error=missing_tokens', { replace: true });\n          return;\n        }\n\n        // Store tokens\n        authService.setTokens(accessToken, refreshToken);\n\n        // Fetch user info\n        const response = await fetch('/api/auth/me', {\n          headers: {\n            'Authorization': `Bearer ${accessToken}`\n          },\n          credentials: 'include'\n        });\n\n        if (!response.ok) {\n          throw new Error('Failed to fetch user info');\n        }\n\n        const userData = await response.json();\n        authService.setUser(userData.user);\n\n        // Check if user must change password (shouldn't happen with OAuth, but check anyway)\n        if (userData.user?.must_change_password) {\n          navigate('/change-password', {\n            replace: true,\n            state: { forcedChange: true }\n          });\n          return;\n        }\n\n        // Check if user is new_user (not approved yet)\n        if (userData.user?.role?.toLowerCase() === 'new_user') {\n          navigate('/pending-approval', { replace: true });\n          return;\n        }\n\n        // Redirect based on role - only root goes to dashboard\n        const isRoot = userData.user?.role === 'root';\n        const defaultRoute = isRoot ? '/dashboard' : '/profile';\n        navigate(defaultRoute, { replace: true });\n\n      } catch (error) {\n        console.error('OAuth callback error:', error);\n        navigate('/login?error=oauth_failed', { replace: true });\n      }\n    };\n\n    handleOAuthCallback();\n  }, [searchParams, navigate]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\n      <div className=\"max-w-md w-full space-y-8 p-8 bg-white rounded-lg shadow-md\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto\"></div>\n          <h2 className=\"mt-6 text-xl font-semibold text-gray-900\">\n            Completando inicio de sesi√≥n...\n          </h2>\n          <p className=\"mt-2 text-sm text-gray-600\">\n            Por favor espera mientras te autenticamos\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["OAuthCallbackPage","searchParams","useSearchParams","navigate","useNavigate","useEffect","accessToken","refreshToken","error","authService","response","userData","_a","_c","_b","defaultRoute","_d","jsx","jsxs"],"mappings":"oEAIA,SAAwBA,GAAoB,CAC1C,KAAM,CAACC,CAAY,EAAIC,EAAA,EACjBC,EAAWC,EAAA,EAEjBC,OAAAA,EAAAA,UAAU,IAAM,EACc,SAAY,aACtC,GAAI,CAEF,MAAMC,EAAcL,EAAa,IAAI,aAAa,EAC5CM,EAAeN,EAAa,IAAI,cAAc,EAC9CO,EAAQP,EAAa,IAAI,OAAO,EAGtC,GAAIO,EAAO,CACT,QAAQ,MAAM,eAAgBA,CAAK,EACnCL,EAAS,gBAAkB,mBAAmBK,CAAK,EAAG,CAAE,QAAS,GAAM,EACvE,MACF,CAGA,GAAI,CAACF,GAAe,CAACC,EAAc,CACjC,QAAQ,MAAM,kCAAkC,EAChDJ,EAAS,8BAA+B,CAAE,QAAS,EAAA,CAAM,EACzD,MACF,CAGAM,EAAY,UAAUH,EAAaC,CAAY,EAG/C,MAAMG,EAAW,MAAM,MAAM,eAAgB,CAC3C,QAAS,CACP,cAAiB,UAAUJ,CAAW,EAAA,EAExC,YAAa,SAAA,CACd,EAED,GAAI,CAACI,EAAS,GACZ,MAAM,IAAI,MAAM,2BAA2B,EAG7C,MAAMC,EAAW,MAAMD,EAAS,KAAA,EAIhC,GAHAD,EAAY,QAAQE,EAAS,IAAI,GAG7BC,EAAAD,EAAS,OAAT,MAAAC,EAAe,qBAAsB,CACvCT,EAAS,mBAAoB,CAC3B,QAAS,GACT,MAAO,CAAE,aAAc,EAAA,CAAK,CAC7B,EACD,MACF,CAGA,KAAIU,GAAAC,EAAAH,EAAS,OAAT,YAAAG,EAAe,OAAf,YAAAD,EAAqB,iBAAkB,WAAY,CACrDV,EAAS,oBAAqB,CAAE,QAAS,EAAA,CAAM,EAC/C,MACF,CAIA,MAAMY,IADSC,EAAAL,EAAS,OAAT,YAAAK,EAAe,QAAS,OACT,aAAe,WAC7Cb,EAASY,EAAc,CAAE,QAAS,EAAA,CAAM,CAE1C,OAASP,EAAO,CACd,QAAQ,MAAM,wBAAyBA,CAAK,EAC5CL,EAAS,4BAA6B,CAAE,QAAS,EAAA,CAAM,CACzD,CACF,GAEA,CACF,EAAG,CAACF,EAAcE,CAAQ,CAAC,EAGzBc,EAAAA,IAAC,MAAA,CAAI,UAAU,4DACb,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,8DACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,0EAAA,CAA2E,EAC1FA,EAAAA,IAAC,KAAA,CAAG,UAAU,2CAA2C,SAAA,kCAEzD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,2CAAA,CAE1C,CAAA,CAAA,CACF,EACF,EACF,CAEJ"}