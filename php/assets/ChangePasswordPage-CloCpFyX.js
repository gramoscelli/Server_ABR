import{c as D,a as U,u as V,b as v,r as t,B as _,j as e,e as B,g as O,h as R,i as M,k as X,E as L,f as H}from"./index-B2xrcMBU.js";import{A as J}from"./AdminLayout-e4C_PfH9.js";import{L as j,I as C}from"./label-DSCW4tBn.js";import{P as W}from"./PasswordStrengthIndicator-CY_5qEmc.js";import{L as G}from"./lock-DfNglbML.js";import{E as N,a as y}from"./eye-BVUG8ufL.js";import{C as K}from"./circle-check-eqNgsW64.js";import{C as Q}from"./circle-x-D0tPSKs-.js";import"./log-out-CVeatBap.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Z=D("triangle-alert",Y);function le(){var S;const E=U(),k=V(),l=v.getUser(),a=(l==null?void 0:l.must_change_password)===!0||((S=E.state)==null?void 0:S.forcedChange)||!1,[d,u]=t.useState(""),[r,m]=t.useState(""),[i,h]=t.useState(""),[x,b]=t.useState(!1),[p,A]=t.useState(!1),[w,T]=t.useState(!1),[f,I]=t.useState(!1),[P,q]=t.useState(null),{toast:n}=_();t.useEffect(()=>{if(a){const s=o=>{o.preventDefault(),o.returnValue=""};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)}},[a]);const F=async s=>{if(s.preventDefault(),!P||!P.valid){n({variant:"destructive",title:"Error",description:"La nueva contraseña no cumple con los requisitos de seguridad"});return}if(r!==i){n({variant:"destructive",title:"Error",description:"Las contraseñas no coinciden"});return}if(!a&&d===r){n({variant:"destructive",title:"Error",description:"La nueva contraseña debe ser diferente a la actual"});return}b(!0);try{const o=await fetch("/api/csrf-token",{credentials:"include"}),{csrfToken:z}=await o.json(),g=await H("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":z},body:JSON.stringify({currentPassword:a?"":d,newPassword:r})});if(g.ok){const c=await g.json();n({title:"Éxito",description:"Contraseña actualizada correctamente"}),a?setTimeout(()=>{v.clearAuth(),k("/login",{replace:!0,state:{message:"Contraseña cambiada. Por favor, inicia sesión con tu nueva contraseña."}})},1500):(c.user&&v.setUser(c.user),u(""),m(""),h(""))}else{const c=await g.json();n({variant:"destructive",title:"Error",description:c.message||"Error al cambiar la contraseña"})}}catch{n({variant:"destructive",title:"Error",description:"Error de red al cambiar la contraseña"})}finally{b(!1)}};return e.jsx(J,{children:e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Cambiar Contraseña"}),e.jsx("p",{className:"mt-2 text-gray-600",children:a?"Debes cambiar tu contraseña para continuar":"Actualiza tu contraseña de acceso al sistema"})]}),a&&e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg flex items-start gap-3",children:[e.jsx(Z,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900",children:"Cambio de contraseña obligatorio"}),e.jsx("p",{className:"text-sm text-yellow-800 mt-1",children:"Un administrador ha cambiado tu contraseña. Por seguridad, debes establecer una nueva contraseña antes de continuar usando el sistema."})]})]}),e.jsxs(B,{children:[e.jsxs(O,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Seguridad de la Cuenta"]}),e.jsx(M,{children:a?"Ingresa una nueva contraseña segura":"Por seguridad, necesitas ingresar tu contraseña actual para cambiarla"})]}),e.jsx(X,{children:e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[!a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"currentPassword",children:"Contraseña Actual"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"currentPassword",type:p?"text":"password",required:!0,value:d,onChange:s=>u(s.target.value),className:"pr-10",placeholder:"Ingresa tu contraseña actual"}),e.jsx("button",{type:"button",onClick:()=>A(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:p?e.jsx(N,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"newPassword",children:"Nueva Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"newPassword",type:w?"text":"password",required:!0,value:r,onChange:s=>m(s.target.value),className:"pr-10",placeholder:"Ingresa tu nueva contraseña",minLength:6}),e.jsx("button",{type:"button",onClick:()=>T(!w),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:w?e.jsx(N,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]}),e.jsx(W,{password:r,onValidationChange:q})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"confirmPassword",children:"Confirmar Nueva Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"confirmPassword",type:f?"text":"password",required:!0,value:i,onChange:s=>h(s.target.value),className:"pr-10",placeholder:"Confirma tu nueva contraseña",minLength:6}),e.jsx("button",{type:"button",onClick:()=>I(!f),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:f?e.jsx(N,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]}),i&&e.jsx("div",{className:"mt-2",children:r===i?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Las contraseñas coinciden"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Las contraseñas no coinciden"})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(L,{type:"submit",disabled:x,className:a?"w-full":"flex-1",children:x?"Actualizando...":a?"Establecer Nueva Contraseña":"Cambiar Contraseña"}),!a&&e.jsx(L,{type:"button",variant:"outline",onClick:()=>{u(""),m(""),h("")},disabled:x,children:"Limpiar"})]})]})})]})]})})}export{le as default};
//# sourceMappingURL=ChangePasswordPage-CloCpFyX.js.map
