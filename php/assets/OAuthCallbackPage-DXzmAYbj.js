import{d as f,u as p,r as g,j as r,b as h}from"./index-CQK1xMEp.js";function w(){const[t]=f(),e=p();return g.useEffect(()=>{(async()=>{var n,c,i,l;try{const s=t.get("accessToken"),u=t.get("refreshToken"),o=t.get("error");if(o){console.error("OAuth error:",o),e("/login?error="+encodeURIComponent(o),{replace:!0});return}if(!s||!u){console.error("Missing tokens in OAuth callback"),e("/login?error=missing_tokens",{replace:!0});return}h.setTokens(s,u);const d=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${s}`},credentials:"include"});if(!d.ok)throw new Error("Failed to fetch user info");const a=await d.json();if(h.setUser(a.user),(n=a.user)!=null&&n.must_change_password){e("/change-password",{replace:!0,state:{forcedChange:!0}});return}if(((i=(c=a.user)==null?void 0:c.role)==null?void 0:i.toLowerCase())==="new_user"){e("/pending-approval",{replace:!0});return}const m=((l=a.user)==null?void 0:l.role)==="root"?"/dashboard":"/profile";e(m,{replace:!0})}catch(s){console.error("OAuth callback error:",s),e("/login?error=oauth_failed",{replace:!0})}})()},[t,e]),r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:r.jsx("div",{className:"max-w-md w-full space-y-8 p-8 bg-white rounded-lg shadow-md",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),r.jsx("h2",{className:"mt-6 text-xl font-semibold text-gray-900",children:"Completando inicio de sesi√≥n..."}),r.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Por favor espera mientras te autenticamos"})]})})})}export{w as default};
//# sourceMappingURL=OAuthCallbackPage-DXzmAYbj.js.map
