import{c as E,u as D,i as I,r as t,b as T,k as A,j as e,e as x,g as m,h,f as g,X as S,B as p}from"./index-CQK1xMEp.js";import{A as R,U as q}from"./AdminLayout-536hJOLm.js";import{I as B}from"./input-CE_qf2K-.js";import{L as w}from"./loader-circle-BV_4tUap.js";import{S as L}from"./search-DViEtzHB.js";import{U as u}from"./user-l60zUKlA.js";import"./lock-D4HCCPhn.js";import"./log-out-CvvekA6y.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],_=E("map-pin",U);function J(){const b=D(),{toast:j}=I(),[r,N]=t.useState(""),[l,n]=t.useState([]),[a,y]=t.useState(null),[G,z]=t.useState(!1),[f,c]=t.useState(!1),i=t.useRef(null);t.useEffect(()=>{const s=T.getUser();if(!((s==null?void 0:s.role)==="root"||(s==null?void 0:s.role)==="admin_employee"||(s==null?void 0:s.role)==="library_employee")){b("/profile");return}},[b]);const v=t.useCallback(async s=>{if(!s.trim()){n([]),c(!1);return}c(!0);try{const o=await A(`/api/socios/search?q=${encodeURIComponent(s)}&limit=20`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Error en la búsqueda");const d=await o.json();if(d.success)n(d.data||[]);else throw new Error(d.message||"Error en la búsqueda")}catch(o){console.error("Error searching socios:",o),j({title:"Error",description:"No se pudo realizar la búsqueda. Por favor, intenta nuevamente.",variant:"destructive"}),n([])}finally{c(!1)}},[j]);t.useEffect(()=>{if(i.current&&clearTimeout(i.current),r.trim().length===0){n([]),c(!1);return}return c(!0),i.current=setTimeout(()=>{v(r)},500),()=>{i.current&&clearTimeout(i.current)}},[r,v]);const k=s=>{y(s)},C=()=>{y(null)};return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Socios"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Busca y consulta información de los socios de la biblioteca"})]}),e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-xl",children:"Buscar Socio"})}),e.jsxs(g,{children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[f?e.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-blue-500 animate-spin"}):e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(B,{type:"text",placeholder:"Escribe para buscar por nombre, apellido o número...",value:r,onChange:s=>N(s.target.value),className:"pl-10",autoFocus:!0}),r&&e.jsx("button",{onClick:()=>N(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(S,{className:"h-4 w-4"})})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"La búsqueda se realiza automáticamente mientras escribes. Busca por nombre, apellido, DNI o número de socio (insensible a mayúsculas)."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(h,{className:"text-lg",children:["Resultados ",l.length>0&&`(${l.length})`]})}),e.jsx(g,{children:f&&l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"h-12 w-12 text-blue-500 mx-auto mb-3 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Buscando socios..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:r?"No se encontraron socios con ese criterio":"Escribe en el buscador para ver resultados"})]}):e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:l.map(s=>e.jsx("button",{onClick:()=>k(s),className:`w-full text-left p-3 rounded-lg border transition-all ${(a==null?void 0:a.So_ID)===s.So_ID?"bg-blue-50 border-blue-500 shadow-md":"bg-white border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(u,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-semibold text-gray-900 truncate",children:[s.So_Apellido,", ",s.So_Nombre]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Socio N° ",s.So_ID]})]})]})},s.So_ID))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{className:"text-lg",children:"Información del Socio"}),a&&e.jsxs(p,{variant:"ghost",size:"sm",onClick:C,className:"text-gray-500 hover:text-gray-700",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Cerrar"]})]})}),e.jsx(g,{children:a?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-4 bg-blue-600 rounded-full",children:e.jsx(u,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[a.So_Apellido,", ",a.So_Nombre]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Número de Socio: ",e.jsxs("span",{className:"font-semibold",children:["#",a.So_ID]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"Nombre"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:a.So_Nombre||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"Apellido"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:a.So_Apellido||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"DNI"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg font-mono",children:a.So_NroDoc||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"Teléfono"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:a.So_Telef||"No especificado"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"Número de Socio"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg font-mono",children:a.So_ID})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"Grupo"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:a.Gr_ID?`Grupo #${a.Gr_ID}`:"Sin grupo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"Email"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:a.So_Email||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500 block mb-1",children:"Fecha de Nacimiento"}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:a.So_FecNac||"No especificado"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-500 block mb-1 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Domicilio de Residencia"]}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-3 rounded-lg",children:a.So_DomRes||"No especificado"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-500 block mb-1 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Domicilio de Cobro"]}),e.jsx("p",{className:"text-base text-gray-900 bg-gray-50 px-4 py-3 rounded-lg",children:a.So_DomCob||"No especificado"})]})]}),e.jsxs("div",{className:"pt-4 border-t flex gap-3",children:[e.jsx(p,{variant:"outline",className:"flex-1",disabled:!0,children:"Ver Historial"}),e.jsx(p,{variant:"outline",className:"flex-1",disabled:!0,children:"Editar Socio"})]})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(u,{className:"h-10 w-10 text-gray-400"})}),e.jsx("p",{className:"text-gray-500",children:"Selecciona un socio de la lista para ver su información"})]})})]})})]})]})})}export{J as default};
//# sourceMappingURL=SociosPage-DBv1oukO.js.map
