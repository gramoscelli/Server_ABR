import{r as t,j as e,C as S,R as D,u as O,L as N}from"./index-C1GA9Qxv.js";import{P as U}from"./PasswordStrengthIndicator-Dz6ERkyk.js";import{L as $}from"./loader-circle-BEuCgZXk.js";import{C as w}from"./circle-x-DLPO0AQB.js";import{C as v}from"./circle-check-O-Sz6jck.js";import{E,a as T}from"./eye-l1R2rkR7.js";function z({username:s,onValidationChange:n}){const[r,l]=t.useState(null),[h,i]=t.useState(!1),[m,f]=t.useState("");return t.useEffect(()=>{fetch("/api/csrf-token",{credentials:"include"}).then(a=>a.json()).then(a=>f(a.csrfToken)).catch(a=>console.error("Failed to get CSRF token:",a))},[]),t.useEffect(()=>{if(!s||s.length===0){l(null),n==null||n(null),i(!1);return}if(!m)return;const a=setTimeout(async()=>{i(!0);try{const c=await fetch("/api/auth/validate-username",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":m},credentials:"include",body:JSON.stringify({username:s})});if(c.ok){const x=await c.json();l(x),n==null||n(x)}}catch(c){console.error("Username validation error:",c)}finally{i(!1)}},300);return()=>clearTimeout(a)},[s,m,n]),!s||s.length===0?null:h?e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-500",children:[e.jsx($,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Validando nombre de usuario..."})]}):r?e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Requisitos:"}),e.jsx("div",{className:"space-y-1",children:r.requirements.filter(a=>a.required).map(a=>a.met?e.jsx("div",{},a.name):e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(w,{className:"h-4 w-4 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("span",{className:"text-gray-900",children:[a.label,a.current!==void 0&&a.expected!==void 0&&!a.met&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",a.current,"/",a.expected,")"]})]})]},a.name))})]}),r.valid&&r.available!==null&&e.jsx("div",{className:"mt-2",children:r.available?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:r.availabilityMessage})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:r.availabilityMessage})]})}),r.valid&&r.available&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 text-green-600"}),e.jsx("p",{className:"text-xs text-green-800",children:"✓ El nombre de usuario es válido y está disponible"})]})}),r.feedback&&r.feedback.length>0&&e.jsx("div",{className:"space-y-0.5",children:r.feedback.map((a,c)=>e.jsxs("p",{className:"text-xs text-gray-600",children:["• ",a]},c))})]}):null}function M({onCaptchaChange:s,error:n}){const[r,l]=t.useState(null),[h,i]=t.useState(""),[m,f]=t.useState(!1),[a,c]=t.useState(""),x=async()=>{f(!0),c(""),i("");try{const o=await fetch("/api/captcha/generate",{credentials:"include"});if(!o.ok)throw new Error("Error al cargar CAPTCHA");const g=await o.json();l(g),s(g.tokenId,"")}catch(o){c(o instanceof Error?o.message:"Error al cargar CAPTCHA"),l(null),s(null,"")}finally{f(!1)}};t.useEffect(()=>{x()},[]);const y=o=>{i(o),r&&s(r.tokenId,o)};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Verificación CAPTCHA"}),e.jsxs("div",{className:"relative border border-gray-300 rounded-lg p-4 bg-gray-50",children:[m&&e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}),a&&e.jsx("div",{className:"flex items-center justify-center h-24 text-red-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:a})]})}),!m&&!a&&r&&e.jsx("div",{className:"captcha-svg-container flex items-center justify-center",dangerouslySetInnerHTML:{__html:r.svg}}),e.jsx("button",{type:"button",onClick:x,disabled:m,className:"absolute top-2 right-2 p-2 text-gray-500 hover:text-indigo-600 hover:bg-white rounded-md transition-colors disabled:opacity-50",title:"Recargar CAPTCHA",children:e.jsx(D,{className:`h-4 w-4 ${m?"animate-spin":""}`})})]}),e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"Ingresa el código que ves arriba",value:h,onChange:o=>y(o.target.value),className:`appearance-none relative block w-full px-3 py-2 border ${n?"border-red-300":"border-gray-300"} placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`,required:!0,autoComplete:"off"}),n&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4"}),n]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"El CAPTCHA expira en 5 minutos. No distingue entre mayúsculas y minúsculas."})]})]})}function K(){const[s,n]=t.useState({username:"",email:"",password:"",confirmPassword:""}),[r,l]=t.useState(""),[h,i]=t.useState(!1),[m,f]=t.useState(!1),[a,c]=t.useState(!1),[x,y]=t.useState(!1),[o,g]=t.useState(null),[b,A]=t.useState(null),[C,R]=t.useState(null),[k,L]=t.useState(""),[H,j]=t.useState("");O();const F=(d,p)=>{R(d),L(p),j("")},I=async d=>{if(d.preventDefault(),l(""),j(""),i(!0),!b||!b.valid){l("El nombre de usuario no cumple con los requisitos"),i(!1);return}if(!b.available){l("El nombre de usuario ya está en uso"),i(!1);return}if(s.password!==s.confirmPassword){l("Las contraseñas no coinciden"),i(!1);return}if(!o||!o.valid){l("La contraseña no cumple con los requisitos de seguridad"),i(!1);return}if(!s.email.includes("@")){l("Por favor ingresa un email válido"),i(!1);return}if(!C||!k){j("Por favor completa el CAPTCHA"),i(!1);return}try{const p=await fetch("/api/csrf-token",{credentials:"include"}),{csrfToken:q}=await p.json(),P=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":q},credentials:"include",body:JSON.stringify({username:s.username,email:s.email,password:s.password,captchaToken:C,captchaResponse:k})}),u=await P.json();if(!P.ok){if(u.captchaRequired||u.error==="CAPTCHA inválido"||u.error==="CAPTCHA requerido"){j(u.message||"CAPTCHA incorrecto"),i(!1);return}throw u.retryAfter?new Error(`${u.message||u.error} Por favor intenta nuevamente en: ${u.retryAfter}.`):new Error(u.message||"Error al registrarse")}f(!0)}catch(p){l(p instanceof Error?p.message:"Error al registrarse")}finally{i(!1)}};return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 p-8 bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:e.jsx(v,{className:"h-6 w-6 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"¡Registro Exitoso!"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Tu cuenta ha sido creada exitosamente."}),e.jsxs("p",{className:"mt-2 text-sm text-gray-500",children:["Te hemos enviado un email de verificación a ",e.jsx("strong",{children:s.email}),". Por favor, revisa tu bandeja de entrada y haz clic en el enlace de verificación para activar tu cuenta."]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Próximos pasos:"}),e.jsxs("ol",{className:"text-xs text-blue-800 space-y-1 list-decimal list-inside",children:[e.jsxs("li",{children:["Revisa tu email (",s.email,")"]}),e.jsx("li",{children:"Haz clic en el enlace de verificación"}),e.jsx("li",{children:"Una vez verificado, podrás iniciar sesión"})]})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(N,{to:"/login",className:"inline-block w-full py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Ir al Login"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["¿No recibiste el email?"," ",e.jsx(N,{to:"/resend-verification",className:"text-indigo-600 hover:text-indigo-500",children:"Reenviar email de verificación"})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 p-8 bg-white rounded-lg shadow-md",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Crear Cuenta"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Regístrate para acceder al sistema"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:I,children:[r&&e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsx("p",{className:"text-sm text-red-800",children:r})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Nombre de Usuario"}),e.jsx("input",{id:"username",name:"username",type:"text",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"usuario123",value:s.username,onChange:d=>n({...s,username:d.target.value}),minLength:3}),e.jsx(z,{username:s.username,onValidationChange:A})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"tu@email.com",value:s.email,onChange:d=>n({...s,email:d.target.value})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Te enviaremos un email de verificación"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Contraseña"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("input",{id:"password",name:"password",type:a?"text":"password",required:!0,className:"appearance-none relative block w-full px-3 py-2 pr-10 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"••••••••",value:s.password,onChange:d=>n({...s,password:d.target.value}),minLength:6}),e.jsx("button",{type:"button",onClick:()=>c(!a),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:a?e.jsx(E,{className:"h-4 w-4"}):e.jsx(T,{className:"h-4 w-4"})})]}),e.jsx(U,{password:s.password,onValidationChange:g})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirmar Contraseña"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:x?"text":"password",required:!0,className:"appearance-none relative block w-full px-3 py-2 pr-10 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"••••••••",value:s.confirmPassword,onChange:d=>n({...s,confirmPassword:d.target.value}),minLength:6}),e.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:x?e.jsx(E,{className:"h-4 w-4"}):e.jsx(T,{className:"h-4 w-4"})})]}),s.confirmPassword&&e.jsx("div",{className:"mt-2",children:s.password===s.confirmPassword?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:"Las contraseñas coinciden"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:"Las contraseñas no coinciden"})]})})]}),e.jsx(M,{onCaptchaChange:F,error:H})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:h,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:h?"Creando cuenta...":"Registrarse"})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["¿Ya tienes una cuenta?"," ",e.jsx(N,{to:"/login",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Inicia sesión"})]})})]})]})})}export{K as default};
//# sourceMappingURL=RegisterPage-B4Ih6Qvv.js.map
